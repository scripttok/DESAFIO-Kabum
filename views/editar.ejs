<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editar Cliente</title>
  </head>
  <body>
    <h1>Editar Cliente</h1>
    <form action="/cliente/<%= cliente.id %>?_method=PUT" method="POST">
      <label for="nome">Nome:</label>
      <input
        type="text"
        name="nome"
        id="nome"
        value="<%= cliente.nome %>"
        required
      /><br />

      <label for="data_nascimento">Data de Nascimento:</label>
      <input
        type="date"
        name="data_nascimento"
        id="data_nascimento"
        value="<%= cliente.data_nascimento %>"
        required
      /><br />

      <label for="cpf">CPF:</label>
      <input
        type="text"
        name="cpf"
        id="cpf"
        value="<%= cliente.cpf %>"
        required
      /><br />

      <label for="rg">RG:</label>
      <input
        type="text"
        name="rg"
        id="rg"
        value="<%= cliente.rg %>"
        required
      /><br />

      <label for="telefone">Telefone:</label>
      <input
        type="text"
        name="telefone"
        id="telefone"
        value="<%= cliente.telefone %>"
        required
      /><br />

      <h3>Endereços:</h3>
      <h3>Endereços:</h3>
      <div id="enderecos-container">
        <% if (cliente.enderecos && cliente.enderecos.length > 0) { %> <%
        cliente.enderecos.forEach((endereco, index) => { %>
        <div class="endereco">
          <label for="enderecos[<%= index %>][endereco]">Endereço:</label>
          <input
            type="text"
            name="enderecos[<%= index %>][endereco]"
            value="<%= endereco.endereco %>"
          />
          <label for="enderecos[<%= index %>][cidade]">Cidade:</label>
          <input
            type="text"
            name="enderecos[<%= index %>][cidade]"
            value="<%= endereco.cidade %>"
          />
          <label for="enderecos[<%= index %>][estado]">Estado:</label>
          <input
            type="text"
            name="enderecos[<%= index %>][estado]"
            value="<%= endereco.estado %>"
          />
          <label for="enderecos[<%= index %>][cep]">CEP:</label>
          <input
            type="text"
            name="enderecos[<%= index %>][cep]"
            value="<%= endereco.cep %>"
          />
        </div>
        <% }) %> <% } %>
      </div>
      <button type="button" onclick="adicionarEndereco()">
        Adicionar Outro Endereço</button
      ><br /><br />

      <script>
        let enderecoCount = <%= cliente.enderecos ? cliente.enderecos.length : 0 %>;

        function adicionarEndereco() {
          const container = document.getElementById("enderecos-container");
          const novoEndereco = document.createElement("div");
          novoEndereco.innerHTML = `
            <label for="enderecos[${enderecoCount}][endereco]">Endereço:</label>
            <input type="text" name="enderecos[${enderecoCount}][endereco]" required /><br />

            <label for="enderecos[${enderecoCount}][cidade]">Cidade:</label>
            <input type="text" name="enderecos[${enderecoCount}][cidade]" /><br />

            <label for="enderecos[${enderecoCount}][estado]">Estado:</label>
            <input type="text" name="enderecos[${enderecoCount}][estado]" /><br />

            <label for="enderecos[${enderecoCount}][cep]">CEP:</label>
            <input type="text" name="enderecos[${enderecoCount}][cep]" /><br />

            <button type="button" onclick="removerEndereco(${enderecoCount})">
              Remover Endereço
            </button><br /><br />
          `;
          container.appendChild(novoEndereco);
          enderecoCount++;
        }

        function removerEndereco(index) {
          const container = document.getElementById("enderecos-container");
          const enderecoToRemove = container.children[index];
          container.removeChild(enderecoToRemove);
        }
      </script>

      <button type="submit">Atualizar</button>
    </form>

    <form action="/cliente/<%= cliente.id %>?_method=DELETE" method="POST">
      <button type="submit" style="color: red">Excluir Cliente</button>
    </form>

    <a href="/clientes">Voltar</a>
  </body>
</html>
